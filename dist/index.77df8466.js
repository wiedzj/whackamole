const t={rows:4,columns:4,horizonHeight:30,maxMoles:3,lives:5,speedIncrease:{time:5e3,increase:1.03},amountOfMolesIncrease:{time:5e3,increase:1},sprites:{moleHill:"./assets/mole-hill.png",ground:"./assets/grass2.jpeg",mole_1:"./assets/mole1.png",mole_2:"./assets/poepie.png",mole_3:"./assets/kip.png"},moles:[{spriteId:1,color:"#E6A951",probability:20,time:1e3,crawlOutTime:500,hit:{type:"point",amount:1},miss:{type:"live",amount:-1}},{spriteId:2,color:"blue",probability:28,time:500,crawlOutTime:1e3,hit:{type:"live",amount:-1}},{spriteId:3,color:"yellow",probability:4,time:750,crawlOutTime:200,hit:{type:"live",amount:1}}]};class i{constructor(t,i,e,s,h){this.aspectRatio=0,this.mole=null,this.image=null,this.x=t,this.y=i,this.width=e,h?(this.aspectRatio=h.naturalWidth/e,this.height=h.naturalHeight/this.aspectRatio,this.image=h):this.height=s}render(){this.image?o.drawImage(this.image,this.x,this.y,this.width,this.height):o.drawShape("black",this.x,this.y,this.width,this.height)}}class e{constructor(t,e,s){this.moleHills=[];const h=t.rows,a=t.columns,l=o.width/(a+1),n=s/(h+1),r=l/(a+1),m=n/(h+1);for(let t=0;t<h;t++){let h=[];for(let o=0;o<a;o++){const a=r*(o+1)+l*o,g=s-m*(t+1)-n*(t+1);h.push(new i(a,g,l,n,e))}this.moleHills.push(h)}}render(){for(let t=0;t<this.moleHills.length;t++)for(let i=0;i<this.moleHills[t].length;i++){const e=this.moleHills[t][i];e.mole&&e.mole.render(),e.render()}}update(){for(let t=0;t<this.moleHills.length;t++)for(let i=0;i<this.moleHills[t].length;i++){const e=this.moleHills[t][i];e.mole&&e.mole.update()}}isEmpty(){for(let t=0;t<this.moleHills.length;t++)for(let i=0;i<this.moleHills[t].length;i++){if(this.moleHills[t][i].mole)return!1}return!0}}class s{constructor(t,i,e,s){this.height=0,this.time=0,this.isHit=!1,this.isMissed=!1,this.img=void 0,this.hitImg=void 0,this.missImg=void 0,this.moleConfig=t,this.crawlOutTime=t.crawlOutTime*e,this.maxTime=t.time*e,this.y=i.y,this.hitBoxWidth=i.width,this.hitBoxX=i.x,this.moleHillHeight=i.height,s?(this.img=s,this.width=s.naturalWidth/i.aspectRatio,this.maxHeight=s.naturalHeight/i.aspectRatio,this.x=i.x+(i.width-this.width)/2):(this.maxHeight=i.width,this.x=i.x+i.width/4,this.width=i.width/2)}hit(){if(!0!==this.isHit&&(this.isHit=!0,void 0!==this.moleConfig.hit))switch(this.moleConfig.hit.type){case"live":void 0!==o.lives&&(o.lives+=this.moleConfig.hit.amount);break;case"point":o.points+=this.moleConfig.hit.amount,console.log(o.points)}}getHitBox(){return{x1:Math.floor(this.hitBoxX-2),x2:Math.floor(this.hitBoxX+this.hitBoxWidth+2),y1:Math.floor(this.y-2),y2:Math.floor(this.y+this.height+2)}}miss(){if(!this.isMissed&&(this.isMissed=!0,void 0!==this.moleConfig.miss))switch(this.moleConfig.miss.type){case"live":void 0!==o.lives&&0!==o.lives&&(o.lives+=this.moleConfig.miss.amount);break;case"point":o.points+=this.moleConfig.miss.amount}}render(){this.isHit?(this.height-=this.maxHeight/20,this.height<0&&(this.height=0)):this.height<this.maxHeight&&this.time<this.maxTime?this.height+=this.maxHeight/(this.crawlOutTime/(1e3/o.frameRate)):this.time>=this.maxTime?(this.height-=this.maxHeight/(this.crawlOutTime/(1e3/o.frameRate)),this.height<0&&(this.height=0)):this.time+=1e3/o.frameRate,this.img?o.drawImage(this.img,this.x,this.y,this.width,this.height,this.isHit?"brightness(0%)":void 0,this.height/this.maxHeight*100):o.drawShape(this.isHit?"red":this.moleConfig.color,this.x,this.y,this.width,this.height)}update(){this.time>=this.maxTime&&this.height<=this.moleHillHeight&&!1===this.isMissed&&0==this.isHit&&this.miss()}}class h{constructor(t,i,e){this.spawnedMoles=[],this.speedMultiplyer=1,this.moleImages=[],this.spawnList=[],this.moleTypes=t.moles,this.moleHills=i,this.maxMoles=t.maxMoles,e&&(this.moleImages=e.sort()),this.generateSpawnList()}generateSpawnList(){this.moleTypes.forEach((t=>{for(let i=0;i<t.probability;i++)this.spawnList.push(this.moleTypes.indexOf(t))}))}spawn(){if(this.spawnedMoles.length>=this.maxMoles)return;0===this.spawnList.length&&this.generateSpawnList();let t=!1;for(;!1===t;){let i=Math.round(Math.random()*(this.moleHills.length-1)),e=Math.round(Math.random()*(this.moleHills[0].length-1)),h=this.moleHills[i][e];if(null===h.mole){let i,e=Math.round(Math.random()*(this.spawnList.length-1)),a=this.moleTypes[this.spawnList[e]];this.spawnList.splice(e,1),a.spriteId&&(i=this.moleImages.find((t=>t.name==="mole_"+a.spriteId)));const o=new s(a,h,this.speedMultiplyer,i?.img);h.mole=o,this.spawnedMoles.push(o),t=!0,setTimeout((()=>{this.spawnedMoles.splice(this.spawnedMoles.indexOf(o),1),h.mole=null}),2*a.crawlOutTime*this.speedMultiplyer+a.time*this.speedMultiplyer)}}}}class a{constructor(){console.log("PewPlatform CREATED"),window.addEventListener("message",(t=>{console.log("RECEIVE message",t),this.receive(t.data)})),window.pew=this}receive(t){if(console.log("G: RECEIVE",t),"play"===t.eventName)this.game.play()}init(t,i){this.game=t,i()}updatescore(t){}gamestarted(){console.log("G: SEND","play"),this.sendEvent({eventName:"play"})}play(){this.game.play()}gameover(t){console.log("G: SEND","Gameover"),this.sendEvent({eventName:"gameover",data:{score:t}})}ready(){console.log("G: SEND","Ready"),this.sendEvent({eventName:"ready"})}sendEvent(t){console.log(t),window.top.postMessage(t,"*")}}class o{constructor(){this.time=0,this.tapToPlay=!0,this.playing=!1,this.gameOver=!1,this.finalScore=null,this.images=[],this.skyImage=null,this.floorImage=void 0,this.imageTimer=0,this.getSettingsFromURI(location.search),document.addEventListener("DOMContentLoaded",(()=>{this.preload()})),window.addEventListener("resize",(()=>{o.height=window.innerHeight,o.width=window.innerWidth,o.ctx.canvas.height=o.height,o.ctx.canvas.width=o.width}))}restart(){clearInterval(this.gameLoop),this.time=0,this.moleSpawner.maxMoles=this.config.maxMoles,this.moleSpawner.speedMultiplyer=1,o.lives=this.config.lives,o.timeLeft=this.config.time,o.points=0,this.finalScore=null,this.gameOver=!1,this.playing=!1,this.tapToPlay=!0}play(){this.gameLoop=setInterval((()=>{this.render(),this.playing&&!this.gameOver&&this.update()}),1e3/o.frameRate)}preload(){if(void 0!==this.config.sprites)for(const[t,i]of Object.entries(this.config.sprites)){let e=new Image;e.onload=()=>{this.images.push({img:e,name:t}),this.imageReady()},e.onerror=()=>{this.images.push({name:t,img:void 0}),this.imageReady()},this.imageTimer+=1,e.src=i.toString()}}imageReady(){this.imageTimer--,0===this.imageTimer&&(console.log("Start loading"),this.load())}load(){console.log("LOAD");const t=document.getElementById("canvas");t.addEventListener("click",(t=>{this.canvasClicked(t)})),t.addEventListener("touchstart",(t=>{for(let i of t.touches)this.canvasClicked(i)})),o.ctx=t.getContext("2d"),o.height=window.innerHeight,o.width=window.innerWidth,o.ctx.canvas.height=o.height,o.ctx.canvas.width=o.width,o.lives=this.config.lives,o.timeLeft=this.config.time;const i=this.images.find((t=>"moleHill"===t.name))?.img;this.floorImage=this.images.find((t=>"ground"===t.name))?.img;const s=this.images.filter((t=>"mole"===t.name.split("_")[0]));let l=o.height*this.config.horizonHeight/100;this.grid=new e(this.config,i,l),this.moleSpawner=new h(this.config,this.grid.moleHills,s),this.pew=new a,this.pew.ready(),this.pew.init(this,(()=>{this.play}))}canvasClicked(t){if(this.tapToPlay)return this.tapToPlay=!1,void setTimeout((()=>{this.pew.gamestarted(),this.playing=!0}),1e3);let i,e;i=t.clientX,e=o.height-t.clientY;let s=this.moleSpawner.spawnedMoles.sort(((t,i)=>t.y-i.y));for(let t=0;t<s.length;t++){const h=s[t],a=h.getHitBox();if(i>a.x1&&i<a.x2&&e>a.y1&&e<a.y2){h.hit();break}}}render(){o.ctx.clearRect(0,0,o.width,o.height),o.drawShape("#33A8FF",0,0,o.width,o.height),this.gameOver||this.tapToPlay||(o.drawText(o.points.toString(),20,o.height-40,"30px Arial","white","start"),void 0!==o.lives&&(o.drawText(o.lives.toString(),o.width-40,o.height-40,"30px Arial","white","end"),o.drawText(" ♥︎ ",o.width-40,o.height-38,"30px Arial","red","start")),void 0!==o.timeLeft&&(o.drawText(Math.ceil(o.timeLeft/1e3).toString(),.55*o.width,o.height-38,"30px Arial","white","end"),o.drawText(" ⨶ ",.55*o.width,o.height-38,"30px Arial","black","start"))),this.floorImage?o.drawImage(this.floorImage,0,0,o.width,o.height*this.config.horizonHeight/100):o.drawShape("green",0,0,o.width,o.height*this.config.horizonHeight/100),this.grid.render(),this.tapToPlay&&!this.gameOver&&(o.drawShape("rgba(0, 0, 0, 0.5)",0,0,o.width,o.height),o.drawText("Tap to play",o.width/2,o.height-40,"30px Arial","white","center")),this.gameOver&&(o.drawShape("rgba(0, 0, 0, 0.5)",0,0,o.width,o.height),o.drawText("GAME OVER - Score: "+this.finalScore,o.width/2,o.height-40,"30px Arial","white","center"))}update(){if(!this.gameOver&&(this.time+=1e3/o.frameRate,this.time>0)){if(this.config.speedIncrease&&this.time%this.config.speedIncrease.time==0&&this.moleSpawner.speedMultiplyer-(this.config.speedIncrease.increase-1)>0&&(this.moleSpawner.speedMultiplyer-=this.config.speedIncrease.increase-1),this.config.amountOfMolesIncrease&&this.time%this.config.amountOfMolesIncrease.time==0&&this.moleSpawner.maxMoles+this.config.amountOfMolesIncrease.increase<this.config.columns*this.config.rows-2&&(this.moleSpawner.maxMoles+=this.config.amountOfMolesIncrease.increase),!1===this.gameOver&&(void 0!==o.timeLeft&&0===o.timeLeft||void 0!==o.lives&&0===o.lives))return this.finalScore=o.points,this.gameOver=!0,this.playing=!1,setTimeout((()=>{this.pew.gameover(this.finalScore),this.restart()}),2e3),void setTimeout((()=>{this.pew.ready()}),4e3);o.timeLeft&&(o.timeLeft-=10),this.grid.update(),this.moleSpawner.spawn()}}static drawImage(t,i,e,s,h,a,o){if(null!==this.ctx){if(e=this.height-e-h,a&&(this.ctx.filter=a),void 0===o)this.ctx.drawImage(t,i,e,s,h);else{const a=0,l=0,n=t.naturalWidth,r=t.naturalHeight*o/100;this.ctx.drawImage(t,a,l,n,r,i,e,s,h)}this.ctx.filter="none"}}static drawShape(t,i,e,s,h){null!==this.ctx&&(h<0&&(h=0),e=this.height-e-h,this.ctx.fillStyle=t,this.ctx.fillRect(i,e,s,h))}static drawText(t,i,e,s,h="white",a="center"){null!==this.ctx&&(e=this.height-e,this.ctx.textAlign=a,this.ctx.font=s,this.ctx.fillStyle=h,this.ctx.fillText(t,i,e))}getSettingsFromURI(i){this.config=t}}o.points=0,o.lives=void 0,o.timeLeft=void 0,o.frameRate=100;new o;
//# sourceMappingURL=index.77df8466.js.map
